<script setup lang="ts">
import { type PostWithRelations } from "@/db/schema/posts";
import { useCommentLikeStore } from "@/store/post/comment/like";
import { useLikeStore } from "@/store/post/like";

interface PostLikeSectionProps {
  post: PostWithRelations;
  isCommentStore?: true;
}

const { post, isCommentStore } = defineProps<PostLikeSectionProps>();
const { session } = useAuth();
const likeStore = isCommentStore ? useCommentLikeStore() : useLikeStore();
const { createLike, updateLike, deleteLike } = likeStore;
const liked = computed(() => post.likes.some((l) => l.userId === session.value?.user.id && l.value === 1));
const unliked = computed(() => post.likes.some((l) => l.userId === session.value?.user.id && l.value === -1));
</script>

<template>
  <div flex flex-col items-center>
    <v-btn
      p-0="!"
      rd-1="!"
      bg-transparent="!"
      width="1.5rem"
      min-width="1.5rem"
      height="1.5rem"
      @click="
        liked
          ? deleteLike(post.id)
          : unliked
            ? updateLike({ postId: post.id, value: 1 })
            : createLike({ postId: post.id, value: 1 })
      "
    >
      <v-icon
        size="x-large"
        :color="liked ? 'primary' : undefined"
        :icon="liked ? 'mdi-arrow-up-bold' : 'mdi-arrow-up-bold-outline'"
      />
    </v-btn>
    {{ post.noLikes }}
    <v-btn
      p-0="!"
      rd-1="!"
      bg-transparent="!"
      width="1.5rem"
      min-width="1.5rem"
      height="1.5rem"
      @click="
        unliked
          ? deleteLike(post.id)
          : liked
            ? updateLike({ postId: post.id, value: -1 })
            : createLike({ postId: post.id, value: -1 })
      "
    >
      <v-icon
        size="x-large"
        :color="unliked ? 'error' : undefined"
        :icon="unliked ? 'mdi-arrow-down-bold' : 'mdi-arrow-down-bold-outline'"
      />
    </v-btn>
  </div>
</template>
